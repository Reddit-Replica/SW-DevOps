pipeline {
    agent any
  	environment {
		DOCKERHUB_CREDENTIALS=credentials('Dockerhub')
	}

    stages {

        stage('pull docker Latest Images') {
            steps {
                echo "========docker pull images ========"
                sh """
                    docker pull waer/backend:latest
                    docker pull waer/frontend:latest
                    docker pull waer/flutterweb:latest
                """    
            }

        }

        // stage("remove any unsued container or network"){
        //     steps{
        //         sh """
        //         docker rm $(docker ps --filter status=exited -q)
        //         docker system prune -a
        //         """
        //     }
        // }

        stage("stop the current production"){
            steps{
                sh """
                cd /Read-it/deployment
                ls
                docker-compose --compatibility down
                """
            }
        }

        stage('start the new production') {
            steps {
                sh """
                cd /Read-it/deployment
                ls
                docker-compose --compatibility up -d
                """
            }
        }

    }
}